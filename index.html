<!DOCTYPE html>
<html>
<head>
    <title>MindAR Invitation Card</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes">	
    <script src="script/aframe.min.js"></script>
    <script src="script/mindar-image-aframe.prod.js"></script>
    <link rel="shortcut icon" type="image/png" href="assets/favicon.png">
    <style>
        body { margin: 0; }
        #scanning-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }
        #scanning-overlay.active { display: flex; }
        .scan-box {
            width: 80%;
            max-width: 300px;
            border: 2px dashed white;
            aspect-ratio: 1;
            position: relative;
        }
        .scan-line {
            position: absolute;
            width: 100%;
            height: 2px;
            background: red;
            animation: scan 2s linear infinite;
        }
        @keyframes scan {
            0% { top: 0; }
            100% { top: 100%; }
        }
    </style>
</head>
<body>
    <div id="scanning-overlay" class="active">
        <div class="scan-box">
            <div class="scan-line"></div>
        </div>
    </div>
<a-scene 
    mindar-image="imageTargetSrc: targets.mind; showStats: false; uiScanning: #scanning-overlay;" 
    embedded 
    color-space="sRGB" 
    renderer="colorManagement: true, physicallyCorrectLights: true"
    vr-mode-ui="enabled: false"
>
    <a-assets>
        <img id="card" src="assets/card.jpg" />
        <img id="ar-content" src="assets/ar1.jpg" />
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <a-entity mindar-image-target="targetIndex: 0" id="targetEntity">

        <a-plane src="#card" position="0 0 0" width="1" height="0.5" id="targetImage"></a-plane>
        

        <a-plane position="0 0 0" width="1" height="0.5" color="white" opacity="0" id="whiteBox"></a-plane>

        <a-text value="You're Invited!" color="black" position="0 0.3 0" scale="2 2 2"></a-text>
    </a-entity>
</a-scene>

<script>
  const scene = document.querySelector('a-scene');
  const whiteBox = document.getElementById('whiteBox');
  const targetImage = document.getElementById('targetImage');

  scene.addEventListener('loaded', () => {
    console.log('Scene fully loaded, safe to interact with elements.');

    scene.addEventListener('targetFound', () => {
      document.getElementById('scanning-overlay').classList.remove('active');

      targetImage.setAttribute('visible', 'false');
      whiteBox.setAttribute('opacity', '1');
    });

    scene.addEventListener('targetLost', () => {
      document.getElementById('scanning-overlay').classList.add('active');

      targetImage.setAttribute('visible', 'true');
      whiteBox.setAttribute('opacity', '0');
    });
  });
</script>

</body>
</html>
