<!DOCTYPE html>
<html>
<head>
    <title>Lavin & Sujitha</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="script/mindar-image-aframe.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@pqina/flip/dist/tick.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script> <!-- Added Typed.js -->
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script>
        const showPortfolio = (done) => {
            const portfolio = document.querySelector("#portfolio-panel");
            let y = -0.5;
            portfolio.setAttribute("visible", true);
            const id = setInterval(() => {
                y += 0.008;
                if (y >= 0) {
                    clearInterval(id);
                    setTimeout(done, 500);
                }
                portfolio.setAttribute("position", `0 ${y} -0.01`);
            }, 10);
        };

        // Countdown to Event
        function updateCountdown() {
            const eventDate = new Date("January 14, 2026 11:00:00");
            const now = new Date();
            const timeDiff = eventDate - now;
            const countdownElement = document.querySelector("#countdown");   
            const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
            const countdownText = `${days}d ${hours}h ${minutes}m ${seconds}s`;
            countdownElement.setAttribute('value', countdownText);
        }
        setInterval(updateCountdown, 1000);

        AFRAME.registerComponent('mytarget', {
            init: function() {
                let confettiTriggered = false;  
                const typedTextEl = document.querySelector("#typed-text"); // This will be your text element
                this.el.addEventListener('targetFound', () => {
                    console.log("target found");
                    const eventDate = new Date("January 14, 2026 11:00:00");
                    const now = new Date();

                    // Hide video and show typed.js element
                    document.querySelector("#Base-video").setAttribute("visible", false); // Hides video
                    typedTextEl.setAttribute("visible", true); // Shows text

                    // Start Typed.js animation
                    const options = {
                        strings: ["Welcome to Lavin & Sujitha's Wedding!", "Countdown begins now..."],
                        typeSpeed: 50,
                        backSpeed: 25,
                        backDelay: 1000,
                        startDelay: 500,
                        showCursor: true,
                        loop: true
                    };
                    const typed = new Typed(typedTextEl, options);

                    // Confetti on target found
                    callConfetti();

                    setTimeout(() => {
                        showPortfolio(() => { });
                    }, 300);
                });

                this.el.addEventListener('targetLost', () => {
                    const typedTextEl = document.querySelector("#typed-text");
                    typedTextEl.setAttribute("visible", false); // Hide typed text when target is lost
                });
            }
        });

        function callConfetti(){
            const emojis = ['ğŸ’–','ğŸ’˜','ğŸ’•','â¤ï¸','ğŸ’','ğŸ’','ğŸ’–','ğŸ’“','â£ï¸'];
            const shape = confetti.shapeFromText({ text: emojis[Math.floor(Math.random() * emojis.length)], scalar: 2 });
                confetti({
                    particleCount: 250,
                    spread: 100,
                    origin: { y: 0.6 },
                    shapes: [shape]
                });
        }
    </script>    
    <style>
        body {
            margin: 0;
        }
        .example-container {
            overflow: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
        }       
        #countdown {
              font-family: 'Orbitron', monospace;
              font-weight: bold;
        }
        .clickable:hover {
            opacity: 0.9;
            cursor: pointer;
        } 
        #typed-text {
            position: absolute;
            color: #CF0A45;
            font-family: 'Fira Sans', sans-serif;
            font-size: 1.5em;
            display: none; /* Hidden by default */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="example-container">
        <div id="example-scanning-overlay" class="hidden">
            <div class="inner">
                <img src="../assets/FrontPage.jpg" />
                <div class="scanline"></div>
            </div>
        </div>      
        <a-scene mindar-image="imageTargetSrc: targets.mind; showStats: false; uiScanning: #example-scanning-overlay;" embedded color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights"
            vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
            <a-assets>
                <video id="Base-video" src="../assets/BaseTemplate.mp4" autoplay="true" loop="false"></video>  
                <audio id="musicmp3" preload="auto" src="../assets/emotional-piano-music-256262.mp3"></audio>
            </a-assets>
            <a-camera position="0 0 0" look-controls="enabled: false" cursor="fuse: false; rayOrigin: mouse;" raycaster="far: 10000; objects: .clickable"></a-camera>
            <a-entity id="mytarget0" mytarget mindar-image-target="targetIndex: 0" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
                <a-entity id="portfolio-panel" position="0 -0.25 -0.01" visible="false">
                    <!-- Typed.js text will show here -->
                    <a-text id="typed-text"></a-text> 
                </a-entity>
            </a-entity>
        </a-scene>
    </div>
</body>
</html>
